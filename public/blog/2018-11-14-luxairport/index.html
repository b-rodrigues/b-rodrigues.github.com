<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"  lang="en-us">
    <title>Easy time-series prediction with R: a tutorial with air traffic data from Lux Airport - Econometrics and Free Software</title>
    <meta name="generator" content="Hugo 0.25.1" />

    
    <meta name="description" content="A blog about econometrics, free software, and R">
    
    <link rel="canonical" href="../../blog/2018-11-14-luxairport/">
    
    <meta name="author" content="Bruno Rodrigues">
    
    <meta name="generator" content="Hugo 0.25.1" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:url" content="/blog/2018-11-14-luxairport/">
    <meta property="og:title" content="Econometrics and Free Software">
    <meta property="og:image" content="/map[url:logo.png width:50 height:50 alt:Logo]">
    <meta name="apple-mobile-web-app-title" content="Econometrics and Free Software">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">

    
    <link rel="stylesheet" href="../../css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="../../css/custom.css">
    <link rel="stylesheet" href="../../css/pygments.css">
    
    <link rel="stylesheet" href="../../css/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/helpers/jquery.fancybox-buttons.css?v=1.0.5" type="text/css" media="screen" />
  </head>
  <body>


<div class="row">
<div class="navbar navbar-default navbar-fixed-top">
<div class="container">
  <div class="navbar-header">
    <a href="../../" class="navbar-brand">Econometrics and Free Software</a>
    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse" id="navbar-main">

    <ul class="nav navbar-nav navbar-right">
      <li><a href="https://www.buymeacoffee.com/brodriguesco">Donate</a></li>
      <li><a href="https://www.youtube.com/c/BrunoRodrigues1988">Youtube</a></li>
      <li><a href="https://github.com/b-rodrigues/">Github</a></li>
      <li><a href="https://twitter.com/brodriguesco/">Twitter</a></li>
    </ul>
  </div>
</div>

</div>

<div class="container">

  <div>
    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-4">
        

<div class="list-group table-of-contents">

  
    <a class="list-group-item" href=#><b>About Me</b></a>
    
    <div class="list-group">
      
      <a class="list-group-item" href="../../about/about/">Who am I?</a>
      
      <a class="list-group-item" href="../../about/projects/">Projects</a>
      
      <a class="list-group-item" href="../../about/research/">Research</a>
      
      <a class="list-group-item" href="../../about/software/">Software</a>
      
    </div>
    
  
    <a class="list-group-item" href=#><b>Blog</b></a>
    
    <div class="list-group">
      
      <a class="list-group-item" href="../../blog/2018-11-25-tidy_cv/">A tutorial on tidy cross-validation with R</a>
      
      <a class="list-group-item" href="../../blog/2018-11-03-nethack_analysis/">Analyzing NetHack data, part 1: What kills the players</a>
      
      <a class="list-group-item" href="../../blog/2018-11-10-nethack_analysis_part2/">Analyzing NetHack data, part 2: What players kill the most</a>
      
      <a class="list-group-item" href="../../blog/2019-02-04-newspapers_shiny_app_tutorial/">Building a shiny app to explore historical newspapers: a step-by-step guide</a>
      
      <a class="list-group-item" href="../../blog/2019-03-03-historical_vowpal/">Classification of historical newspapers content: a tutorial combining R, bash and Vowpal Wabbit, part 1</a>
      
      <a class="list-group-item" href="../../blog/2019-03-05-historical_vowpal_part2/">Classification of historical newspapers content: a tutorial combining R, bash and Vowpal Wabbit, part 2</a>
      
      <a class="list-group-item" href="../../blog/2019-06-20-tidy_eval_saga/">Curly-Curly, the successor of Bang-Bang</a>
      
      <a class="list-group-item" href="../../blog/2018-07-08-rob_stderr/">Dealing with heteroskedasticity; regression with robust standard errors using R</a>
      
      <a class="list-group-item" href="../../blog/2018-11-14-luxairport/">Easy time-series prediction with R: a tutorial with air traffic data from Lux Airport</a>
      
      <a class="list-group-item" href="../../blog/2018-10-05-ggplot2_purrr_officer/">Exporting editable plots from R to Powerpoint: making ggplot2 purrr with officer</a>
      
      <a class="list-group-item" href="../../blog/2019-04-28-diffindiff_part1/">Fast food, causality and R packages, part 1</a>
      
      <a class="list-group-item" href="../../blog/2019-05-04-diffindiff_part2/">Fast food, causality and R packages, part 2</a>
      
      <a class="list-group-item" href="../../blog/2019-05-18-xml2/">For posterity: install {xml2} on GNU/Linux distros</a>
      
      <a class="list-group-item" href="../../blog/2018-06-24-fun_ts/">Forecasting my weight with R</a>
      
      <a class="list-group-item" href="../../blog/2018-11-01-nethack/">From webscraping data to releasing it as an R package to share with the world: a full tutorial with data from NetHack</a>
      
      <a class="list-group-item" href="../../blog/2019-03-31-tesseract/">Get text from pdfs or images using OCR: a tutorial with {tesseract} and {magick}</a>
      
      <a class="list-group-item" href="../../blog/2018-06-10-scraping_pdfs/">Getting data from pdfs using the pdftools package</a>
      
      <a class="list-group-item" href="../../blog/2018-10-21-lux_elections/">Getting the data from the Luxembourguish elections out of Excel</a>
      
      <a class="list-group-item" href="../../blog/2018-09-11-human_to_machine/">Going from a human readable Excel file to a machine-readable csv with {tidyxl}</a>
      
      <a class="list-group-item" href="../../blog/2019-04-07-historical_newspaper_scraping_tesseract/">Historical newspaper scraping with {tesseract} and R</a>
      
      <a class="list-group-item" href="../../blog/2018-09-15-time_use/">How Luxembourguish residents spend their time: a small {flexdashboard} demo using the Time use survey data</a>
      
      <a class="list-group-item" href="../../blog/2018-04-14-playing_with_furrr/">Imputing missing values in parallel using {furrr}</a>
      
      <a class="list-group-item" href="../../blog/2019-06-12-intermittent/">Intermittent demand, Croston and Die Hard</a>
      
      <a class="list-group-item" href="../../blog/2019-01-04-newspapers/">Looking into 19th century ads from a Luxembourguish newspaper with R</a>
      
      <a class="list-group-item" href="../../blog/2019-01-13-newspapers_mets_alto/">Making sense of the METS and ALTO XML standards</a>
      
      <a class="list-group-item" href="../../blog/2018-12-15-lubridate_africa/">Manipulate dates easily with {lubridate}</a>
      
      <a class="list-group-item" href="../../blog/2019-02-10-stringr_package/">Manipulating strings with the {stringr} package</a>
      
      <a class="list-group-item" href="../../blog/2018-10-27-lux_elections_analysis/">Maps with pie charts on top of each administrative division: an example with Luxembourg&#39;s elections data</a>
      
      <a class="list-group-item" href="../../blog/2018-07-01-tidy_ive/">Missing data imputation and instrumental variables regression: the tidy approach</a>
      
      <a class="list-group-item" href="../../blog/2019-08-17-modern_r/">Modern R with the tidyverse is available on Leanpub</a>
      
      <a class="list-group-item" href="../../blog/2018-12-24-modern_objects/">Objects types and some useful R functions for beginners</a>
      
      <a class="list-group-item" href="../../blog/2019-03-20-pivot/">Pivoting data frames just got easier thanks to `pivot_wide()` and `pivot_long()`</a>
      
      <a class="list-group-item" href="../../blog/2018-12-30-reticulate/">R or Python? Why not both? Using Anaconda Python within R with {reticulate}</a>
      
      <a class="list-group-item" href="../../blog/2018-11-15-tidy_gridsearch/">Searching for the optimal hyper-parameters of an ARIMA model in parallel: the tidy gridsearch approach</a>
      
      <a class="list-group-item" href="../../blog/2018-12-27-fun_gganimate/">Some fun with {gganimate}</a>
      
      <a class="list-group-item" href="../../blog/2019-10-05-parallel_maxlik/">Split-apply-combine for Maximum Likelihood Estimation of a linear model</a>
      
      <a class="list-group-item" href="../../blog/2019-07-19-statmatch/">Statistical matching, or when one single data source is not enough</a>
      
      <a class="list-group-item" href="../../blog/2018-11-21-lux_castle/">The best way to visit Luxembourguish castles is doing data science &#43; combinatorial optimization</a>
      
      <a class="list-group-item" href="../../blog/2019-05-19-spacemacs/">The never-ending editor war (?)</a>
      
      <a class="list-group-item" href="../../blog/2018-09-08-steam_linux/">The year of the GNU&#43;Linux desktop is upon us: using user ratings of Steam Play compatibility to play around with regex and the tidyverse</a>
      
      <a class="list-group-item" href="../../blog/2019-01-31-newspapers_shiny_app/">Using Data Science to read 10 years of Luxembourguish newspapers from the 19th century</a>
      
      <a class="list-group-item" href="../../blog/2018-11-16-rgenoud_arima/">Using a genetic algorithm for the hyperparameter optimization of a SARIMA model</a>
      
      <a class="list-group-item" href="../../blog/2019-06-04-cosine_sim/">Using cosine similarity to find matching documents: a tutorial using Seneca&#39;s letters to his friend Lucilius</a>
      
      <a class="list-group-item" href="../../blog/2019-08-14-lpm/">Using linear models with binary dependent variables, a simulation study</a>
      
      <a class="list-group-item" href="../../blog/2018-12-21-tidyverse_pi/">Using the tidyverse for more than data manipulation: estimating pi with Monte Carlo methods</a>
      
      <a class="list-group-item" href="../../blog/2018-12-02-hyper-parameters/">What hyper-parameters are, and what to do with them; an illustration with ridge regression</a>
      
      <a class="list-group-item" href="../../blog/2019-09-03-disk_frame/">{disk.frame} is epic</a>
      
      <a class="list-group-item" href="../../blog/2018-04-15-announcing_pmice/">{pmice}, an experimental package for missing data imputation in parallel using {mice} and {furrr}</a>
      
      <a class="list-group-item" href="../../blog/2017-12-27-build_formulae/">Building formulae</a>
      
      <a class="list-group-item" href="../../blog/2017-11-14-peace_r/">Functional peace of mind</a>
      
      <a class="list-group-item" href="../../blog/2018-04-10-brotools_describe/">Get basic summary statistics for all the variables in a data frame</a>
      
      <a class="list-group-item" href="../../blog/2018-03-03-sparklyr_h2o_rsparkling/">Getting {sparklyr}, {h2o}, {rsparkling} to work together and some fun with bash</a>
      
      <a class="list-group-item" href="../../blog/2018-02-16-importing_30gb_of_data/">Importing 30GB of data into R with sparklyr</a>
      
      <a class="list-group-item" href="../../blog/2017-03-27-introducing_brotools/">Introducing brotools</a>
      
      <a class="list-group-item" href="../../blog/2018-01-03-lists_all_the_way/">It&#39;s lists all the way down</a>
      
      <a class="list-group-item" href="../../blog/2018-01-05-lists_all_the_way2/">It&#39;s lists all the way down, part 2: We need to go deeper</a>
      
      <a class="list-group-item" href="../../blog/2018-03-12-keep_trying/">Keep trying that api call with purrr::possibly()</a>
      
      <a class="list-group-item" href="../../blog/2017-06-19-dplyr-0-70-tutorial/">Lesser known dplyr 0.7* tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-02-17-lesser_known_tricks/">Lesser known dplyr tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-03-24-lesser_known_purrr/">Lesser known purrr tricks</a>
      
      <a class="list-group-item" href="../../blog/2017-03-29-make-ggplot2-purrr/">Make ggplot2 purrr</a>
      
      <a class="list-group-item" href="../../blog/2018-01-19-mapping_functions_with_any_cols/">Mapping a list of functions to a list of datasets with a list of columns as arguments</a>
      
      <a class="list-group-item" href="../../blog/2018-02-11-census-random_forest/">Predicting job search by training a random forest on an unbalanced dataset</a>
      
      <a class="list-group-item" href="../../blog/2017-12-17-teaching_tidyverse/">Teaching the tidyverse to beginners</a>
      
      <a class="list-group-item" href="../../blog/2017-08-27-why_tidyeval/">Why I find tidyeval useful</a>
      
      <a class="list-group-item" href="../../blog/2017-07-27-spread_rename_at/">tidyr::spread() and dplyr::rename_at() in action</a>
      
      <a class="list-group-item" href="../../blog/2017-10-26-margins_r/">Easy peasy STATA-like marginal effects with R</a>
      
      <a class="list-group-item" href="../../blog/2016-12-24-functional-programming-and-unit-testing-for-data-munging-with-r-available-on-leanpub/">Functional programming and unit testing for data munging with R available on Leanpub</a>
      
      <a class="list-group-item" href="../../blog/2017-02-17-how_to_use_jailbreakr/">How to use jailbreakr</a>
      
      <a class="list-group-item" href="../../blog/2017-01-07-my-free-book-has-a-cover/">My free book has a cover!</a>
      
      <a class="list-group-item" href="../../blog/2016-12-21-work-on-lists-of-datasets-instead-of-individual-datasets-by-using-functional-programming/">Work on lists of datasets instead of individual datasets by using functional programming</a>
      
      <a class="list-group-item" href="../../blog/2013-01-29-method-of-simulated-moments-with-r/">Method of Simulated Moments with R</a>
      
      <a class="list-group-item" href="../../blog/2012-12-11-new-website/">New website!</a>
      
      <a class="list-group-item" href="../../blog/2013-11-07-gmm-with-rmd/">Nonlinear Gmm with R - Example with a logistic regression</a>
      
      <a class="list-group-item" href="../../blog/2013-01-16-simulated-maximum-likelihood-with-r/">Simulated Maximum Likelihood with R</a>
      
      <a class="list-group-item" href="../../blog/2015-11-11-bootstrapping-did-with-r/">Bootstrapping standard errors for difference-in-differences estimation with R</a>
      
      <a class="list-group-item" href="../../blog/2016-06-21-careful-with-trycatch/">Careful with tryCatch</a>
      
      <a class="list-group-item" href="../../blog/2016-07-18-data-frame-columns-as-arguments-to-dplyr-functions/">Data frame columns as arguments to dplyr functions</a>
      
      <a class="list-group-item" href="../../blog/2015-02-22-export-r-output-to-file/">Export R output to a file</a>
      
      <a class="list-group-item" href="../../blog/2016-11-04-ive-started-writing-a-book-functional-programming-and-unit-testing-for-data-munging-with-r/">I&#39;ve started writing a &#39;book&#39;: Functional programming and unit testing for data munging with R</a>
      
      <a class="list-group-item" href="../../blog/2015-01-12-introduction-to-programming-econometrics-with-r/">Introduction to programming econometrics with R</a>
      
      <a class="list-group-item" href="../../blog/2016-07-30-merge-a-list-of-datasets-together/">Merge a list of datasets together</a>
      
      <a class="list-group-item" href="../../blog/2014-04-23-r-s4-rootfinding/">Object Oriented Programming with R: An example with a Cournot duopoly</a>
      
      <a class="list-group-item" href="../../blog/2014-11-11-benchmarks-r-blas-atlas-rro/">R, R with Atlas, R with OpenBLAS and Revolution R Open: which is fastest?</a>
      
      <a class="list-group-item" href="../../blog/2016-07-26-read-a-lot-of-datasets-at-once-with-r/">Read a lot of datasets at once with R</a>
      
      <a class="list-group-item" href="../../blog/2016-03-31-unit-testing-with-r/">Unit testing with R</a>
      
      <a class="list-group-item" href="../../blog/2015-05-03-update-introduction-r-programming/">Update to Introduction to programming econometrics with R</a>
      
      <a class="list-group-item" href="../../blog/2013-12-31-r-cas/">Using R as a Computer Algebra System with Ryacas</a>
      
    </div>
    
  

</div>

      </div>
      <div class="col-lg-9 col-md-9 col-sm-8">
        <div>
           <h1 id="main">Easy time-series prediction with R: a tutorial with air traffic data from Lux Airport</h1>
           <span class="article-date">November 14, 2018</span>
        </div>
        <div style="text-align:center;">
<p><a href="https://www.youtube.com/watch?v=GIQn8pab8Vc">
<img src="../../img/lx_aie.jpg" title = "Luxembourg's largest aircraft landing"></a></p>
</div>
<p>In this blog post, I will show you how you can quickly and easily forecast a univariate time series.
I am going to use data from the EU Open Data Portal on air passenger transport. You can find the
data <a href="https://data.europa.eu/euodp/en/data/dataset/2EwfWXj5d94BUOzfoABKSQ">here</a>. I downloaded
the data in the TSV format for Luxembourg Airport, but you could repeat the analysis for any airport.</p>
<p>Once you have the data, load some of the package we are going to need:</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)
library(forecast)
library(tsibble)
library(brotools)</code></pre>
<p>and define the following function:</p>
<pre class="r"><code>ihs &lt;- function(x){
    log(x + sqrt(x**2 + 1))
}</code></pre>
<p>This function, the inverse hyperbolic sine, is useful to transform data in a manner that is very
close to logging it, but that allows for 0’s. The data from Eurostat is not complete for some reason,
so there are some 0 sometimes. To avoid having to log 0, which in R yields <code>-Inf</code>, I use this
transformation.</p>
<p>Now, let’s load the data:</p>
<pre class="r"><code>avia &lt;- read_tsv(&quot;avia_par_lu.tsv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>Let’s take a look at the data:</p>
<pre class="r"><code>head(avia)</code></pre>
<pre><code>## # A tibble: 6 x 238
##   `unit,tra_meas,… `2018Q1` `2018M03` `2018M02` `2018M01` `2017Q4` `2017Q3`
##   &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;   
## 1 FLIGHT,CAF_PAS,… 511      172       161       178       502      475     
## 2 FLIGHT,CAF_PAS,… :        :         :         :         :        :       
## 3 FLIGHT,CAF_PAS,… :        :         :         :         399      306     
## 4 FLIGHT,CAF_PAS,… 485      167       151       167       493      497     
## 5 FLIGHT,CAF_PAS,… 834      293       267       274       790      728     
## 6 FLIGHT,CAF_PAS,… :        :         :         :         :        :       
## # … with 231 more variables: `2017Q2` &lt;chr&gt;, `2017Q1` &lt;chr&gt;,
## #   `2017M12` &lt;chr&gt;, `2017M11` &lt;chr&gt;, `2017M10` &lt;chr&gt;, `2017M09` &lt;chr&gt;,
## #   `2017M08` &lt;chr&gt;, `2017M07` &lt;chr&gt;, `2017M06` &lt;chr&gt;, `2017M05` &lt;chr&gt;,
## #   `2017M04` &lt;chr&gt;, `2017M03` &lt;chr&gt;, `2017M02` &lt;chr&gt;, `2017M01` &lt;chr&gt;,
## #   `2017` &lt;chr&gt;, `2016Q4` &lt;chr&gt;, `2016Q3` &lt;chr&gt;, `2016Q2` &lt;chr&gt;,
## #   `2016Q1` &lt;chr&gt;, `2016M12` &lt;chr&gt;, `2016M11` &lt;chr&gt;, `2016M10` &lt;chr&gt;,
## #   `2016M09` &lt;chr&gt;, `2016M08` &lt;chr&gt;, `2016M07` &lt;chr&gt;, `2016M06` &lt;chr&gt;,
## #   `2016M05` &lt;chr&gt;, `2016M04` &lt;chr&gt;, `2016M03` &lt;chr&gt;, `2016M02` &lt;chr&gt;,
## #   `2016M01` &lt;chr&gt;, `2016` &lt;chr&gt;, `2015Q4` &lt;chr&gt;, `2015Q3` &lt;chr&gt;,
## #   `2015Q2` &lt;chr&gt;, `2015Q1` &lt;chr&gt;, `2015M12` &lt;chr&gt;, `2015M11` &lt;chr&gt;,
## #   `2015M10` &lt;chr&gt;, `2015M09` &lt;chr&gt;, `2015M08` &lt;chr&gt;, `2015M07` &lt;chr&gt;,
## #   `2015M06` &lt;chr&gt;, `2015M05` &lt;chr&gt;, `2015M04` &lt;chr&gt;, `2015M03` &lt;chr&gt;,
## #   `2015M02` &lt;chr&gt;, `2015M01` &lt;chr&gt;, `2015` &lt;chr&gt;, `2014Q4` &lt;chr&gt;,
## #   `2014Q3` &lt;chr&gt;, `2014Q2` &lt;chr&gt;, `2014Q1` &lt;chr&gt;, `2014M12` &lt;chr&gt;,
## #   `2014M11` &lt;chr&gt;, `2014M10` &lt;chr&gt;, `2014M09` &lt;chr&gt;, `2014M08` &lt;chr&gt;,
## #   `2014M07` &lt;chr&gt;, `2014M06` &lt;chr&gt;, `2014M05` &lt;chr&gt;, `2014M04` &lt;chr&gt;,
## #   `2014M03` &lt;chr&gt;, `2014M02` &lt;chr&gt;, `2014M01` &lt;chr&gt;, `2014` &lt;chr&gt;,
## #   `2013Q4` &lt;chr&gt;, `2013Q3` &lt;chr&gt;, `2013Q2` &lt;chr&gt;, `2013Q1` &lt;chr&gt;,
## #   `2013M12` &lt;chr&gt;, `2013M11` &lt;chr&gt;, `2013M10` &lt;chr&gt;, `2013M09` &lt;chr&gt;,
## #   `2013M08` &lt;chr&gt;, `2013M07` &lt;chr&gt;, `2013M06` &lt;chr&gt;, `2013M05` &lt;chr&gt;,
## #   `2013M04` &lt;chr&gt;, `2013M03` &lt;chr&gt;, `2013M02` &lt;chr&gt;, `2013M01` &lt;chr&gt;,
## #   `2013` &lt;chr&gt;, `2012Q4` &lt;chr&gt;, `2012Q3` &lt;chr&gt;, `2012Q2` &lt;chr&gt;,
## #   `2012Q1` &lt;chr&gt;, `2012M12` &lt;chr&gt;, `2012M11` &lt;chr&gt;, `2012M10` &lt;chr&gt;,
## #   `2012M09` &lt;chr&gt;, `2012M08` &lt;chr&gt;, `2012M07` &lt;chr&gt;, `2012M06` &lt;chr&gt;,
## #   `2012M05` &lt;chr&gt;, `2012M04` &lt;chr&gt;, `2012M03` &lt;chr&gt;, `2012M02` &lt;chr&gt;,
## #   `2012M01` &lt;chr&gt;, `2012` &lt;chr&gt;, …</code></pre>
<p>So yeah, useless in that state. The first column actually is composed of 3 columns, merged together,
and instead of having one column with the date, and another with the value, we have one column
per date. Some cleaning is necessary before using this data.</p>
<p>Let’s start with going from a wide to a long data set:</p>
<pre class="r"><code>avia %&gt;%
    select(&quot;unit,tra_meas,airp_pr\\time&quot;, contains(&quot;20&quot;)) %&gt;%
    gather(date, passengers, -`unit,tra_meas,airp_pr\\time`)</code></pre>
<p>The first line makes it possible to only select the columns that contain the string “20”, so
selecting columns from 2000 onward. Then, using gather, I go from long to wide. The data looks
like this now:</p>
<pre><code>## # A tibble: 117,070 x 3
##    `unit,tra_meas,airp_pr\\time`  date   passengers
##    &lt;chr&gt;                          &lt;chr&gt;  &lt;chr&gt;     
##  1 FLIGHT,CAF_PAS,LU_ELLX_AT_LOWW 2018Q1 511       
##  2 FLIGHT,CAF_PAS,LU_ELLX_BE_EBBR 2018Q1 :         
##  3 FLIGHT,CAF_PAS,LU_ELLX_CH_LSGG 2018Q1 :         
##  4 FLIGHT,CAF_PAS,LU_ELLX_CH_LSZH 2018Q1 485       
##  5 FLIGHT,CAF_PAS,LU_ELLX_DE_EDDF 2018Q1 834       
##  6 FLIGHT,CAF_PAS,LU_ELLX_DE_EDDI 2018Q1 :         
##  7 FLIGHT,CAF_PAS,LU_ELLX_DE_EDDM 2018Q1 1095      
##  8 FLIGHT,CAF_PAS,LU_ELLX_DE_EDDR 2018Q1 :         
##  9 FLIGHT,CAF_PAS,LU_ELLX_DE_EDDT 2018Q1 :         
## 10 FLIGHT,CAF_PAS,LU_ELLX_DK_EKCH 2018Q1 :         
## # … with 117,060 more rows</code></pre>
<p>Now, let’s separate the first column into 3 columns:</p>
<pre class="r"><code>avia %&gt;%
    select(&quot;unit,tra_meas,airp_pr\\time&quot;, contains(&quot;20&quot;)) %&gt;%
    gather(date, passengers, -`unit,tra_meas,airp_pr\\time`) %&gt;%
     separate(col = `unit,tra_meas,airp_pr\\time`, into = c(&quot;unit&quot;, &quot;tra_meas&quot;, &quot;air_pr\\time&quot;), sep = &quot;,&quot;)</code></pre>
<p>This separates the first column into 3 new columns, “unit”, “tra_meas” and “air_pr\time”. This step
is not necessary for the rest of the analysis, but might as well do it. The data looks like this now:</p>
<pre><code>## # A tibble: 117,070 x 5
##    unit   tra_meas `air_pr\\time`  date   passengers
##    &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;  &lt;chr&gt;     
##  1 FLIGHT CAF_PAS  LU_ELLX_AT_LOWW 2018Q1 511       
##  2 FLIGHT CAF_PAS  LU_ELLX_BE_EBBR 2018Q1 :         
##  3 FLIGHT CAF_PAS  LU_ELLX_CH_LSGG 2018Q1 :         
##  4 FLIGHT CAF_PAS  LU_ELLX_CH_LSZH 2018Q1 485       
##  5 FLIGHT CAF_PAS  LU_ELLX_DE_EDDF 2018Q1 834       
##  6 FLIGHT CAF_PAS  LU_ELLX_DE_EDDI 2018Q1 :         
##  7 FLIGHT CAF_PAS  LU_ELLX_DE_EDDM 2018Q1 1095      
##  8 FLIGHT CAF_PAS  LU_ELLX_DE_EDDR 2018Q1 :         
##  9 FLIGHT CAF_PAS  LU_ELLX_DE_EDDT 2018Q1 :         
## 10 FLIGHT CAF_PAS  LU_ELLX_DK_EKCH 2018Q1 :         
## # … with 117,060 more rows</code></pre>
<p>The next steps are simple renamings. I have copy-pasted the information from the Eurostat page
where you can <a href="http://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=avia_par_lu&amp;lang=en">view the data online</a>.
If you click here:</p>
<p><img src="../../img/eurostat_click_here.png" /><!-- --></p>
<p>you will be able to select the variables you want displayed in the table, as well as the dictionary
of the variables. I simply copy pasted it and recoded the variables. You can take a look at the
whole cleaning workflow by clicking “Click to expand” below:</p>
<details>
<p><summary>Click here to take a look at the whole cleaning workflow</summary></p>
<pre class="r"><code>avia_clean &lt;- avia %&gt;%
    select(&quot;unit,tra_meas,airp_pr\\time&quot;, contains(&quot;20&quot;)) %&gt;%
    gather(date, passengers, -`unit,tra_meas,airp_pr\\time`) %&gt;%
    separate(col = `unit,tra_meas,airp_pr\\time`, into = c(&quot;unit&quot;, &quot;tra_meas&quot;, &quot;air_pr\\time&quot;), sep = &quot;,&quot;) %&gt;%
    mutate(tra_meas = fct_recode(tra_meas,
         `Passengers on board` = &quot;PAS_BRD&quot;,
         `Passengers on board (arrivals)` = &quot;PAS_BRD_ARR&quot;,
         `Passengers on board (departures)` = &quot;PAS_BRD_DEP&quot;,
         `Passengers carried` = &quot;PAS_CRD&quot;,
         `Passengers carried (arrival)` = &quot;PAS_CRD_ARR&quot;,
         `Passengers carried (departures)` = &quot;PAS_CRD_DEP&quot;,
         `Passengers seats available` = &quot;ST_PAS&quot;,
         `Passengers seats available (arrivals)` = &quot;ST_PAS_ARR&quot;,
         `Passengers seats available (departures)` = &quot;ST_PAS_DEP&quot;,
         `Commercial passenger air flights` = &quot;CAF_PAS&quot;,
         `Commercial passenger air flights (arrivals)` = &quot;CAF_PAS_ARR&quot;,
         `Commercial passenger air flights (departures)` = &quot;CAF_PAS_DEP&quot;)) %&gt;%
    mutate(unit = fct_recode(unit,
                             Passenger = &quot;PAS&quot;,
                             Flight = &quot;FLIGHT&quot;,
                             `Seats and berths` = &quot;SEAT&quot;)) %&gt;%
    mutate(destination = fct_recode(`air_pr\\time`,
                                     `WIEN-SCHWECHAT` = &quot;LU_ELLX_AT_LOWW&quot;,
                                     `BRUSSELS` = &quot;LU_ELLX_BE_EBBR&quot;,
                                     `GENEVA` = &quot;LU_ELLX_CH_LSGG&quot;,
                                     `ZURICH` = &quot;LU_ELLX_CH_LSZH&quot;,
                                     `FRANKFURT/MAIN` = &quot;LU_ELLX_DE_EDDF&quot;,
                                     `HAMBURG` = &quot;LU_ELLX_DE_EDDH&quot;,
                                     `BERLIN-TEMPELHOF` = &quot;LU_ELLX_DE_EDDI&quot;,
                                     `MUENCHEN` = &quot;LU_ELLX_DE_EDDM&quot;,
                                     `SAARBRUECKEN` = &quot;LU_ELLX_DE_EDDR&quot;,
                                     `BERLIN-TEGEL` = &quot;LU_ELLX_DE_EDDT&quot;,
                                     `KOBENHAVN/KASTRUP` = &quot;LU_ELLX_DK_EKCH&quot;,
                                     `HURGHADA / INTL` = &quot;LU_ELLX_EG_HEGN&quot;,
                                     `IRAKLION/NIKOS KAZANTZAKIS` = &quot;LU_ELLX_EL_LGIR&quot;,
                                     `FUERTEVENTURA` = &quot;LU_ELLX_ES_GCFV&quot;,
                                     `GRAN CANARIA` = &quot;LU_ELLX_ES_GCLP&quot;,
                                     `LANZAROTE` = &quot;LU_ELLX_ES_GCRR&quot;,
                                     `TENERIFE SUR/REINA SOFIA` = &quot;LU_ELLX_ES_GCTS&quot;,
                                     `BARCELONA/EL PRAT` = &quot;LU_ELLX_ES_LEBL&quot;,
                                     `ADOLFO SUAREZ MADRID-BARAJAS` = &quot;LU_ELLX_ES_LEMD&quot;,
                                     `MALAGA/COSTA DEL SOL` = &quot;LU_ELLX_ES_LEMG&quot;,
                                     `PALMA DE MALLORCA` = &quot;LU_ELLX_ES_LEPA&quot;,
                                     `SYSTEM - PARIS` = &quot;LU_ELLX_FR_LF90&quot;,
                                     `NICE-COTE D&#39;AZUR` = &quot;LU_ELLX_FR_LFMN&quot;,
                                     `PARIS-CHARLES DE GAULLE` = &quot;LU_ELLX_FR_LFPG&quot;,
                                     `STRASBOURG-ENTZHEIM` = &quot;LU_ELLX_FR_LFST&quot;,
                                     `KEFLAVIK` = &quot;LU_ELLX_IS_BIKF&quot;,
                                     `MILANO/MALPENSA` = &quot;LU_ELLX_IT_LIMC&quot;,
                                     `BERGAMO/ORIO AL SERIO` = &quot;LU_ELLX_IT_LIME&quot;,
                                     `ROMA/FIUMICINO` = &quot;LU_ELLX_IT_LIRF&quot;,
                                     `AGADIR/AL MASSIRA` = &quot;LU_ELLX_MA_GMAD&quot;,
                                     `AMSTERDAM/SCHIPHOL` = &quot;LU_ELLX_NL_EHAM&quot;,
                                     `WARSZAWA/CHOPINA` = &quot;LU_ELLX_PL_EPWA&quot;,
                                     `PORTO` = &quot;LU_ELLX_PT_LPPR&quot;,
                                     `LISBOA` = &quot;LU_ELLX_PT_LPPT&quot;,
                                     `STOCKHOLM/ARLANDA` = &quot;LU_ELLX_SE_ESSA&quot;,
                                     `MONASTIR/HABIB BOURGUIBA` = &quot;LU_ELLX_TN_DTMB&quot;,
                                     `ENFIDHA-HAMMAMET INTERNATIONAL` = &quot;LU_ELLX_TN_DTNH&quot;,
                                     `ENFIDHA ZINE EL ABIDINE BEN ALI` = &quot;LU_ELLX_TN_DTNZ&quot;,
                                     `DJERBA/ZARZIS` = &quot;LU_ELLX_TN_DTTJ&quot;,
                                     `ANTALYA (MIL-CIV)` = &quot;LU_ELLX_TR_LTAI&quot;,
                                     `ISTANBUL/ATATURK` = &quot;LU_ELLX_TR_LTBA&quot;,
                                     `SYSTEM - LONDON` = &quot;LU_ELLX_UK_EG90&quot;,
                                     `MANCHESTER` = &quot;LU_ELLX_UK_EGCC&quot;,
                                     `LONDON GATWICK` = &quot;LU_ELLX_UK_EGKK&quot;,
                                     `LONDON/CITY` = &quot;LU_ELLX_UK_EGLC&quot;,
                                     `LONDON HEATHROW` = &quot;LU_ELLX_UK_EGLL&quot;,
                                     `LONDON STANSTED` = &quot;LU_ELLX_UK_EGSS&quot;,
                                     `NEWARK LIBERTY INTERNATIONAL, NJ.` = &quot;LU_ELLX_US_KEWR&quot;,
                                     `O.R TAMBO INTERNATIONAL` = &quot;LU_ELLX_ZA_FAJS&quot;)) %&gt;%
    mutate(passengers = as.numeric(passengers)) %&gt;%
    select(unit, tra_meas, destination, date, passengers)</code></pre>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
</details>
<p>There is quarterly data and monthly data. Let’s separate the two:</p>
<pre class="r"><code>avia_clean_quarterly &lt;- avia_clean %&gt;%
    filter(tra_meas == &quot;Passengers on board (arrivals)&quot;,
           !is.na(passengers)) %&gt;%
    filter(str_detect(date, &quot;Q&quot;)) %&gt;%
    mutate(date = yq(date))</code></pre>
<p>In the “date” column, I detect the observations with “Q” in their name, indicating that it is quarterly data.
I do the same for monthly data, but I have to add the string “01” to the dates. This transforms
a date that looks like this “2018M1” to this “2018M101”. “2018M101” can then be converted into a
date by using the <code>ymd()</code> function from lubridate. <code>yq()</code> was used for the quarterly data.</p>
<pre class="r"><code>avia_clean_monthly &lt;- avia_clean %&gt;%
    filter(tra_meas == &quot;Passengers on board (arrivals)&quot;,
           !is.na(passengers)) %&gt;%
    filter(str_detect(date, &quot;M&quot;)) %&gt;%
    mutate(date = paste0(date, &quot;01&quot;)) %&gt;%
    mutate(date = ymd(date)) %&gt;%
    select(destination, date, passengers)</code></pre>
<p>Time for some plots. Let’s start with the raw data:</p>
<pre class="r"><code>avia_clean_monthly %&gt;%
    group_by(date) %&gt;%
    summarise(total = sum(passengers)) %&gt;%
    ggplot() +
    ggtitle(&quot;Raw data&quot;) +
    geom_line(aes(y = total, x = date), colour = &quot;#82518c&quot;) +
    scale_x_date(date_breaks = &quot;1 year&quot;, date_labels = &quot;%m-%Y&quot;) + 
    theme_blog()</code></pre>
<p><img src="../../blog/2018-11-14-luxairport_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>And now with the logged data (or rather, the data transformed using the inverted hyperbolic sine
transformation):</p>
<pre class="r"><code>avia_clean_monthly %&gt;%
    group_by(date) %&gt;%
    summarise(total = sum(passengers)) %&gt;%
    mutate(total_ihs = ihs(total)) %&gt;%
    ggplot() +
    ggtitle(&quot;Logged data&quot;) +
    geom_line(aes(y = total_ihs, x = date), colour = &quot;#82518c&quot;) +
    scale_x_date(date_breaks = &quot;1 year&quot;, date_labels = &quot;%m-%Y&quot;) + 
    theme_blog()</code></pre>
<p><img src="../../blog/2018-11-14-luxairport_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>We clearly see a seasonal pattern in the data. There is also an upward trend. We will have to deal
with these two problems if we want to do some forecasting. For this, let’s limit ourselves to data
from before 2015, and convert the “passengers” column from the data to a time series object, using
the <code>ts()</code> function:</p>
<pre class="r"><code>avia_clean_train &lt;- avia_clean_monthly %&gt;%
    select(date, passengers) %&gt;%
    filter(year(date) &lt; 2015) %&gt;%
    group_by(date) %&gt;%
    summarise(total_passengers = sum(passengers)) %&gt;%
    pull(total_passengers) %&gt;%
    ts(., frequency = 12, start = c(2005, 1))</code></pre>
<p>We will try to <em>pseudo</em>-forecast the data from 2015 to the last point available, March 2018.
First, let’s tranform the data:</p>
<pre class="r"><code>logged_data &lt;- ihs(avia_clean_train)</code></pre>
<p>Taking the log, or ihs of the data deals with stabilizing the variance of the time series.</p>
<p>There might also be a need to difference the data. Computing the differences between consecutive
observations makes the time-series stationary. This will be taken care of by the <code>auto.arima()</code>
function, if needed. The <code>auto.arima()</code> function returns the best ARIMA model according to different
statistical criterions, such as the AIC, AICc or BIC.</p>
<pre class="r"><code>(model_fit &lt;- auto.arima(logged_data))</code></pre>
<pre><code>## Series: logged_data 
## ARIMA(2,1,1)(2,1,0)[12] 
## 
## Coefficients:
##           ar1      ar2      ma1     sar1     sar2
##       -0.4061  -0.2431  -0.3562  -0.5590  -0.3282
## s.e.   0.2003   0.1432   0.1994   0.0911   0.0871
## 
## sigma^2 estimated as 0.004503:  log likelihood=137.11
## AIC=-262.21   AICc=-261.37   BIC=-246.17</code></pre>
<p><code>auto.arima()</code> found that the best model would be an <span class="math inline">\(ARIMA(2, 1, 1)(2, 1, 0)_{12}\)</span>. This is an
seasonal autoregressive model, with p = 2, d = 1, q = 1, P = 2 and D = 1.</p>
<pre class="r"><code>model_forecast &lt;- forecast(model_fit, h = 39)</code></pre>
<p>I can now forecast the model for the next 39 months (which correspond to the data available).</p>
<p>To plot the forecast, one could do a simple call to the plot function. But the resulting plot
is not very aesthetic. To plot my own, I have to grab the data that was forecast, and do some
munging again:</p>
<pre class="r"><code>point_estimate &lt;- model_forecast$mean %&gt;%
    as_tsibble() %&gt;%
    rename(point_estimate = value,
           date = index)

upper &lt;- model_forecast$upper %&gt;%
    as_tsibble() %&gt;%
    spread(key, value) %&gt;%
    rename(date = index,
           upper80 = `80%`,
           upper95 = `95%`)

lower &lt;- model_forecast$lower %&gt;%
    as_tsibble() %&gt;%
    spread(key, value) %&gt;%
    rename(date = index,
           lower80 = `80%`,
           lower95 = `95%`)

estimated_data &lt;- reduce(list(point_estimate, upper, lower), full_join, by = &quot;date&quot;)</code></pre>
<p><code>as_tsibble()</code> is a function from the <code>{tsibble}</code> package that converts objects that are <em>time-series aware</em>
to <em>time-aware</em> tibbles. If you are not familiar with <code>ts_tibble()</code>, I urge you to run the above lines
one by one, and especially to compare <code>as_tsibble()</code> with the standard <code>as_tibble()</code> from the <code>{tibble}</code>
package.</p>
<p>This is how <code>estimated_data</code> looks:</p>
<pre class="r"><code>head(estimated_data)</code></pre>
<pre><code>## # A tsibble: 6 x 6 [1M]
##       date point_estimate upper80 upper95 lower80 lower95
##      &lt;mth&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 2015 Jan           11.9    12.0    12.1    11.8    11.8
## 2 2015 Feb           11.9    12.0    12.0    11.8    11.7
## 3 2015 Mar           12.1    12.2    12.3    12.0    12.0
## 4 2015 Apr           12.2    12.3    12.4    12.1    12.1
## 5 2015 May           12.3    12.4    12.4    12.2    12.1
## 6 2015 Jun           12.3    12.4    12.5    12.2    12.1</code></pre>
<p>We can now plot the data, with the forecast, and with the 95% confidence interval:</p>
<pre class="r"><code>avia_clean_monthly %&gt;%
    group_by(date) %&gt;%
    summarise(total = sum(passengers)) %&gt;%
    mutate(total_ihs = ihs(total)) %&gt;%
    ggplot() +
    ggtitle(&quot;Logged data&quot;) +
    geom_line(aes(y = total_ihs, x = date), colour = &quot;#82518c&quot;) +
    scale_x_date(date_breaks = &quot;1 year&quot;, date_labels = &quot;%m-%Y&quot;) +
    geom_ribbon(data = estimated_data, aes(x = date, ymin = lower95, ymax = upper95), fill = &quot;#666018&quot;, alpha = 0.2) +
    geom_line(data = estimated_data, aes(x = date, y = point_estimate), linetype = 2, colour = &quot;#8e9d98&quot;) +
    theme_blog()</code></pre>
<p><img src="../../blog/2018-11-14-luxairport_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>The pseudo-forecast (the dashed line) is not very far from the truth, only overestimating the
seasonal peaks, but the true line is within the 95% confidence interval, which is good!</p>
<p>Hope you enjoyed! If you found this blog post useful, you might want to follow
me on <a href="https://www.twitter.com/brodriguesco">twitter</a> for blog post updates or
<a href="https://www.buymeacoffee.com/brodriguesco">buy me an espresso</a>.</p>
<style>.bmc-button img{width: 27px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{line-height: 36px !important;height:37px !important;text-decoration: none !important;display:inline-flex !important;color:#ffffff !important;background-color:#272b30 !important;border-radius: 3px !important;border: 1px solid transparent !important;padding: 1px 9px !important;font-size: 22px !important;letter-spacing:0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;-o-transition: 0.3s all linear !important;-webkit-transition: 0.3s all linear !important;-moz-transition: 0.3s all linear !important;-ms-transition: 0.3s all linear !important;transition: 0.3s all linear !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#82518c !important;}</style>
<p><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/brodriguesco"><img src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg" alt="Buy me an Espresso"><span style="margin-left:5px">Buy me an Espresso</span></a></p>

      </div>
    </div>
  <div class="row">
    <div class="col-lg-9 col-md-9 col-sm-8 col-lg-offset-3 col-md-offset-3">
    <footer>
  <div class="row">
    <div class="col-lg-12">
      <p>Copyright 2020. <a> Bruno Rodrigues</a> </p>
      <p>Made with the HUGO theme <a href="https://github.com/adejoux/hugo-darkdoc-theme" rel="nofollow">darkdoc</a>.</p>
    </div>
  </div>
</footer>

</body>

    </div>
  </div>

</div>
</html>
<script>

  var api_url = '';

</script>
<script src="//code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="../../js/application.js"></script>
<script type="text/javascript" src="../../js/jquery.fancybox.pack.js?v=2.1.5"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../js/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<script type="text/javascript">
  $(document).ready(function() {
    $(".fancybox").fancybox();
  });
</script>

